<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Love Gift</title>
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #ff66b2, #660066);
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #660066;
    }

    /* Overlay (used for login & popups) */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    /* Popup window */
    .popup {
      background: #fff;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 400px;
      animation: popupIn 0.4s ease forwards;
      position: relative;
    }

    @keyframes popupIn {
      from { transform: scale(0.8); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .popup-header h2 {
      margin: 0;
      font-size: 1.5rem;
      color: #660066;
    }

    .close-btn {
      background: #ffe6f2;
      border: none;
      font-size: 1.5rem;
      color: #ff3399;
      cursor: pointer;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: #ffb3d9;
    }

    /* Input + buttons */
    .popup input, .popup textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ffb3d9;
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 15px;
    }

    .popup button[type="submit"],
    .gift-btn {
      background: #ff66b2;
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
    }

    .popup button[type="submit"]:hover,
    .gift-btn:hover {
      background: #e05599;
    }

    /* Main content */
    #mainContainer {
      display: none;
      background: #fff0f6;
      padding: 40px 20px;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    #mainContainer h1 {
      font-family: 'Sacramento', cursive;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    #mainContainer p {
      font-size: 1.2rem;
      margin-bottom: 20px;
    }

    .gift-btn { margin: 8px 0; }

    .status {
      margin-top: 8px;
      font-size: 0.9rem;
      color: green;
      display: none;
    }

    @media (max-width: 480px) {
      .popup { padding: 20px; }
      .popup-header h2 { font-size: 1.3rem; }
      .close-btn { width: 30px; height: 30px; font-size: 1.2rem; }
      #mainContainer h1 { font-size: 2rem; }
      #mainContainer p { font-size: 1rem; }
    }
  </style>
</head>
<body>

  <!-- Login Popup -->
  <div class="overlay" id="loginOverlay">
    <div class="popup">
      <div class="popup-header">
        <h2>Enter Password</h2>
        <button class="close-btn" onclick="closeLogin()">&times;</button>
      </div>
      <input type="password" id="passwordInput" placeholder="Your secret password">
      <div id="errorMsg" style="color:#cc0033; font-weight:bold; height:20px;"></div>
      <button type="submit" onclick="checkPassword()">Login</button>
      <button type="button" onclick="openChangePassword()" style="margin-top:10px;background:#cc66ff;">Change Password</button>
    </div>
  </div>

  <!-- Change Password Popup -->
  <div class="overlay" id="changePasswordOverlay">
    <div class="popup">
      <div class="popup-header">
        <h2>Change Password</h2>
        <button class="close-btn" onclick="closeChangePassword()">&times;</button>
      </div>
      <input type="password" id="newPasswordInput" placeholder="Enter new password">
      <button type="submit" onclick="saveNewPassword()">Save New Password</button>
      <div id="passwordStatus" class="status">Saved!</div>
    </div>
  </div>

  <!-- Main Content -->
  <div id="mainContainer">
    <h1 contenteditable="true" oninput="saveData('title', this.textContent)">My Special Gift</h1>
    <p contenteditable="true" oninput="saveData('subtitle', this.textContent)">For my baby, enjoy üíñ</p>
    <button class="gift-btn" onclick="openGift('photoPopup')">üì∏ Photo</button>
    <button class="gift-btn" onclick="openGift('letterPopup')">‚úâÔ∏è Letter</button>
    <button class="gift-btn" onclick="openGift('poemPopup')">üìú Poem</button>
    <button class="gift-btn" onclick="openGift('surprisePopup')">üéÅ Surprise</button>
  </div>

  <!-- Gift Overlays -->
  <div class="overlay" id="giftOverlay">
    <!-- Photo -->
    <div class="popup" id="photoPopup">
      <div class="popup-header">
        <h2>Upload Your Photo</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <label for="photoInput" style="cursor:pointer; color:#ff3399;">üì§ Choose Photo</label>
      <input type="file" id="photoInput" accept="image/*" style="display:none;">
      <img id="photoPreview" alt="Photo Preview" style="display:none; max-width:100%; border-radius:10px; margin-top:10px;">
      <div id="caption" contenteditable="true" style="display:none; margin-top:10px; border:1px dashed #ff99cc; padding:10px; border-radius:10px;">Write a caption...</div>
      <button id="removePhotoBtn" style="display:none; margin-top:10px; background:#cc0033;">Remove Photo</button>
      <div id="photoStatus" class="status">Saved!</div>
    </div>

    <!-- Letter -->
    <div class="popup" id="letterPopup">
      <div class="popup-header">
        <h2>Your Letter</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <textarea id="letterArea" placeholder="Write your love letter..." oninput="saveData('letter', this.value)"></textarea>
      <div id="letterStatus" class="status">Saved!</div>
    </div>

    <!-- Poem -->
    <div class="popup" id="poemPopup">
      <div class="popup-header">
        <h2>Your Poem</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <textarea id="poemArea" placeholder="Write your sweet poem..." oninput="saveData('poem', this.value)"></textarea>
      <div id="poemStatus" class="status">Saved!</div>
    </div>

    <!-- Surprise -->
    <div class="popup" id="surprisePopup">
      <div class="popup-header">
        <h2>Your Surprise</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <textarea id="surpriseArea" placeholder="Add your surprise here..." oninput="saveData('surprise', this.value)"></textarea>
      <div id="surpriseStatus" class="status">Saved!</div>
    </div>
  </div>

  <!-- Firebase v8 SDK (Compat Build) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <script>
    // Firebase Config
   
    import { initializeApp } from "firebase/app";
    import { getAnalytics } from "firebase/analytics";
    
    
    const firebaseConfig = {
      apiKey: "AIzaSyAZx8qN76w_gfgKZncYZ9q27el1N0dNDWU",
      authDomain: "love-gift-490e7.firebaseapp.com",
      projectId: "love-gift-490e7",
      storageBucket: "love-gift-490e7.appspot.com",
      messagingSenderId: "249512373513",
      appId: "1:249512373513:web:105f1415f9ca11f85a77d8",
      measurementId: "G-9WC34ZQPE9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    let currentPassword = "120422"; // default until loaded

    // --- LOGIN ---
    const loginOverlay = document.getElementById("loginOverlay");
    const mainContainer = document.getElementById("mainContainer");
    const passwordInput = document.getElementById("passwordInput");
    const errorMsg = document.getElementById("errorMsg");

    window.onload = async () => {
      loginOverlay.style.display = "flex";
      passwordInput.focus();

      // Load password from Firestore
      const doc = await db.collection("settings").doc("password").get();
      if (doc.exists) {
        currentPassword = doc.data().value;
      }
    };

    function checkPassword() {
      if (passwordInput.value.trim() === currentPassword) {
        loginOverlay.style.display = "none";
        mainContainer.style.display = "block";
        loadData();
      } else {
        errorMsg.textContent = "Wrong password, try again!";
        passwordInput.value = "";
        passwordInput.focus();
      }
    }

    function closeLogin() {
      loginOverlay.style.display = "none";
    }

    // --- CHANGE PASSWORD ---
    const changePasswordOverlay = document.getElementById("changePasswordOverlay");
    const newPasswordInput = document.getElementById("newPasswordInput");
    const passwordStatus = document.getElementById("passwordStatus");

    function openChangePassword() {
      changePasswordOverlay.style.display = "flex";
    }
    function closeChangePassword() {
      changePasswordOverlay.style.display = "none";
    }
    function saveNewPassword() {
      const newPass = newPasswordInput.value.trim();
      if (!newPass) return;
      db.collection("settings").doc("password").set({ value: newPass }).then(() => {
        currentPassword = newPass;
        passwordStatus.style.display = "block";
        setTimeout(() => passwordStatus.style.display = "none", 2000);
      });
    }

    // --- GIFTS ---
    const giftOverlay = document.getElementById("giftOverlay");
    const giftPopups = document.querySelectorAll("#giftOverlay .popup");

    function openGift(id) {
      giftOverlay.style.display = "flex";
      giftPopups.forEach(p => p.style.display = "none");
      document.getElementById(id).style.display = "block";
    }
    function closeGift() {
      giftOverlay.style.display = "none";
      giftPopups.forEach(p => p.style.display = "none");
    }

    // --- SAVE / LOAD DATA ---
    function saveData(field, value) {
      db.collection("gift").doc("content").set({ [field]: value }, { merge: true }).then(() => {
        const statusEl = document.getElementById(field + "Status");
        if (statusEl) {
          statusEl.style.display = "block";
          setTimeout(() => statusEl.style.display = "none", 2000);
        }
      });
    }

    async function loadData() {
      const doc = await db.collection("gift").doc("content").get();
      if (doc.exists) {
        const data = doc.data();
        if (data.title) document.querySelector("#mainContainer h1").textContent = data.title;
        if (data.subtitle) document.querySelector("#mainContainer p").textContent = data.subtitle;
        if (data.letter) document.getElementById("letterArea").value = data.letter;
        if (data.poem) document.getElementById("poemArea").value = data.poem;
        if (data.surprise) document.getElementById("surpriseArea").value = data.surprise;
      }

      // Photo
      const photoDoc = await db.collection("gift").doc("photo").get();
      if (photoDoc.exists) {
        const pData = photoDoc.data();
        if (pData.imageUrl) {
          photoPreview.src = pData.imageUrl;
          photoPreview.style.display = "block";
          caption.style.display = "block";
          caption.textContent = pData.caption || "Write a caption...";
          removePhotoBtn.style.display = "inline-block";
        }
      }
    }

    // --- PHOTO UPLOAD ---
    const photoInput = document.getElementById("photoInput");
    const photoPreview = document.getElementById("photoPreview");
    const caption = document.getElementById("caption");
    const removePhotoBtn = document.getElementById("removePhotoBtn");

    photoInput.addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;
      const storageRef = storage.ref("photo/photo.jpg");
      storageRef.put(file).then(() => {
        storageRef.getDownloadURL().then(url => {
          db.collection("gift").doc("photo").set({
            imageUrl: url,
            caption: caption.textContent || "",
            timestamp: Date.now()
          }).then(() => {
            photoStatus.style.display = "block";
            setTimeout(() => photoStatus.style.display = "none", 2000);
          });
        });
      });
    });

    caption.addEventListener("input", () => {
      db.collection("gift").doc("photo").set({
        caption: caption.textContent
      }, { merge: true }).then(() => {
        photoStatus.style.display = "block";
        setTimeout(() => photoStatus.style.display = "none", 2000);
      });
    });

    removePhotoBtn.addEventListener("click", () => {
      const storageRef = storage.ref("photo/photo.jpg");
      storageRef.delete().then(() => {
        db.collection("gift").doc("photo").delete();
        photoPreview.style.display = "none";
        caption.style.display = "none";
        removePhotoBtn.style.display = "none";
      });
    });
  </script>
</body>
</html>


