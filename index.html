<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Love Gift</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #ff66b2, #660066);
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #660066;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .popup {
      background: #fff;
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 400px;
      animation: popupIn 0.4s ease forwards;
      position: relative;
    }
    @keyframes popupIn {
      from { transform: scale(0.8); opacity: 0; }
      to   { transform: scale(1); opacity: 1; }
    }
    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .popup-header h2 {
      margin: 0;
      font-size: 1.5rem;
      color: #660066;
    }
    .close-btn {
      background: #ffe6f2;
      border: none;
      font-size: 1.5rem;
      color: #ff3399;
      cursor: pointer;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .popup input, .popup textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #ffb3d9;
      border-radius: 12px;
      font-size: 1rem;
      margin-bottom: 15px;
    }
    .popup button[type="submit"],
    .gift-btn {
      background: #ff66b2;
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
    }
    .popup button[type="submit"]:hover,
    .gift-btn:hover { background: #e05599; }
    #mainContainer {
      display: none;
      background: #fff0f6;
      padding: 40px 20px;
      border-radius: 20px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }
    #mainContainer h1 {
      font-family: 'Sacramento', cursive;
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .gift-btn { margin: 8px 0; }
    .saved {
      display: none;
      color: green;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <!-- Login -->
  <div class="overlay" id="loginOverlay">
    <div class="popup">
      <div class="popup-header">
        <h2>Enter Password</h2>
      </div>
      <input type="password" id="passwordInput" placeholder="Your secret password">
      <div id="errorMsg" style="color:#cc0033; font-weight:bold; height:20px;"></div>
      <button type="submit" onclick="checkPassword()">Login</button>
    </div>
  </div>

  <!-- Main -->
  <div id="mainContainer">
    <h1>My Special Gift</h1>
    <button class="gift-btn" onclick="openGift('photoPopup')">üì∏ Photo</button>
    <button class="gift-btn" onclick="openGift('letterPopup')">‚úâÔ∏è Letter</button>
    <button class="gift-btn" onclick="openGift('poemPopup')">üìú Poem</button>
    <button class="gift-btn" onclick="openGift('surprisePopup')">üéÅ Surprise</button>
  </div>

  <!-- Overlays -->
  <div class="overlay" id="giftOverlay">
    <!-- Photo -->
    <div class="popup" id="photoPopup">
      <div class="popup-header">
        <h2>Upload Photo</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <input type="file" id="photoInput" accept="image/*">
      <img id="photoPreview" style="display:none; max-width:100%; margin-top:10px; border-radius:10px;">
      <button id="removePhotoBtn" onclick="removePhoto()" style="display:none; margin-top:10px;">Remove Photo</button>
      <p id="savedIndicatorPhoto" class="saved">Saved!</p>
    </div>
    <!-- Letter -->
    <div class="popup" id="letterPopup">
      <div class="popup-header">
        <h2>Letter</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <textarea id="letterInput" placeholder="Write your letter..."></textarea>
      <button onclick="saveLetter()">Save</button>
      <p id="savedIndicatorLetter" class="saved">Saved!</p>
    </div>
    <!-- Poem -->
    <div class="popup" id="poemPopup">
      <div class="popup-header">
        <h2>Poem</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <textarea id="poemInput" placeholder="Write your poem..."></textarea>
      <button onclick="savePoem()">Save</button>
      <p id="savedIndicatorPoem" class="saved">Saved!</p>
    </div>
    <!-- Surprise -->
    <div class="popup" id="surprisePopup">
      <div class="popup-header">
        <h2>Surprise</h2>
        <button class="close-btn" onclick="closeGift()">&times;</button>
      </div>
      <textarea id="surpriseInput" placeholder="Write your surprise..."></textarea>
      <button onclick="saveSurprise()">Save</button>
      <p id="savedIndicatorSurprise" class="saved">Saved!</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZx8qN76w_gfgKZncYZ9q27el1N0dNDWU",
      authDomain: "love-gift-490e7.firebaseapp.com",
      projectId: "love-gift-490e7",
      storageBucket: "love-gift-490e7.appspot.com",
      messagingSenderId: "249512373513",
      appId: "1:249512373513:web:105f1415f9ca11f85a77d8",
      measurementId: "G-9WC34ZQPE9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // Login
    const PASSWORD = "120422";
    const loginOverlay = document.getElementById("loginOverlay");
    const mainContainer = document.getElementById("mainContainer");
    function checkPassword() {
      const input = document.getElementById("passwordInput").value;
      if (input === PASSWORD) {
        loginOverlay.style.display = "none";
        mainContainer.style.display = "block";
      } else {
        document.getElementById("errorMsg").textContent = "Wrong password!";
      }
    }
    window.onload = () => { loginOverlay.style.display = "flex"; };

    // Gift popup
    const giftOverlay = document.getElementById("giftOverlay");
    function openGift(id) {
      giftOverlay.style.display = "flex";
      document.querySelectorAll("#giftOverlay .popup").forEach(p => p.style.display = "none");
      document.getElementById(id).style.display = "block";
    }
    function closeGift() { giftOverlay.style.display = "none"; }

    function showSaved(id) {
      const el = document.getElementById(id);
      el.style.display = "block";
      setTimeout(() => el.style.display = "none", 2000);
    }

    // Letter
    const letterRef = doc(db, "gift", "letter");
    async function saveLetter() {
      await setDoc(letterRef, { content: document.getElementById("letterInput").value });
      showSaved("savedIndicatorLetter");
    }
    onSnapshot(letterRef, snap => {
      if (snap.exists()) document.getElementById("letterInput").value = snap.data().content;
    });

    // Poem
    const poemRef = doc(db, "gift", "poem");
    async function savePoem() {
      await setDoc(poemRef, { content: document.getElementById("poemInput").value });
      showSaved("savedIndicatorPoem");
    }
    onSnapshot(poemRef, snap => {
      if (snap.exists()) document.getElementById("poemInput").value = snap.data().content;
    });

    // Surprise
    const surpriseRef = doc(db, "gift", "surprise");
    async function saveSurprise() {
      await setDoc(surpriseRef, { content: document.getElementById("surpriseInput").value });
      showSaved("savedIndicatorSurprise");
    }
    onSnapshot(surpriseRef, snap => {
      if (snap.exists()) document.getElementById("surpriseInput").value = snap.data().content;
    });

    // Photo
    const photoRef = doc(db, "gift", "photo");
    const photoInput = document.getElementById("photoInput");
    const photoPreview = document.getElementById("photoPreview");
    const removeBtn = document.getElementById("removePhotoBtn");

    photoInput.addEventListener("change", async e => {
      const file = e.target.files[0];
      if (!file) return;
      const storageRef = ref(storage, "photo/photo.jpg");
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);
      await setDoc(photoRef, { imageUrl: url });
      showSaved("savedIndicatorPhoto");
    });

    onSnapshot(photoRef, snap => {
      if (snap.exists()) {
        photoPreview.src = snap.data().imageUrl;
        photoPreview.style.display = "block";
        removeBtn.style.display = "block";
      } else {
        photoPreview.style.display = "none";
        removeBtn.style.display = "none";
      }
    });

    async function removePhoto() {
      const storageRef = ref(storage, "photo/photo.jpg");
      await deleteObject(storageRef);
      await setDoc(photoRef, {}); // clear
      showSaved("savedIndicatorPhoto");
    }
  </script>
</body>
</html>
